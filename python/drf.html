

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Framework: Django Rest Framework &mdash; Fullcoder Manuales</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/faculty.css" type="text/css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans|Roboto:400,700|Roboto+Mono:400,700&display=swap" type="text/css" />
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="Testing en Python" href="testing.html" />
    <link rel="prev" title="Microframework: Flask" href="flask.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

  
    <a class="heading heading-extra-margin" href="../index.html">
      <div class="logo-box logo-box-large">
        <img class="logo" src="../_static/fullcoderlogo.png"/>
      </div>
      
        <span class="icon icon-home"> Fullcoder</span>
      
    </a>
  

  
    
    
  

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">PHP:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../php/sintaxis.html">Sintaxis PHP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../php/funciones.html">Funciones predefinidas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../php/procesamiento.html">Comunicación Cliente / Servidor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../php/database.html">Manipulación de base de datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../php/paquetes.html">Manejo de paquetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../php/cifrado.html">Codificación y Hash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../php/laravel.html">Framework: Laravel</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="sintaxis.html">Sintaxis Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="funciones.html">Funciones predefinidas</a></li>
<li class="toctree-l1"><a class="reference internal" href="librerias.html">Librería Estandar</a></li>
<li class="toctree-l1"><a class="reference internal" href="otras_librerias.html">Otras Librerías Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Bases de datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="paquetes.html">Manejo de paquetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="emails.html">Emails con Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="entornos.html">Entornos Virtuales</a></li>
<li class="toctree-l1"><a class="reference internal" href="analisis.html">Análisis de datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="django.html">Framework: Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="flask.html">Microframework: Flask</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Framework: Django Rest Framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#primeros-pasos">Primeros Pasos</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#crear-un-proyecto-django">Crear un proyecto Django</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instalar-y-configurar-django-rest-framework">Instalar y configurar Django Rest Framework</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#serializadores">Serializadores</a></li>
<li class="toctree-l2"><a class="reference internal" href="#viewsets">ViewSets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#custom-endpoints">Custom Endpoints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rutas-de-la-api">Rutas de la API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modelo-relacional-y-como-mostrarlo">Modelo relacional y como mostrarlo</a></li>
<li class="toctree-l2"><a class="reference internal" href="#permisos">Permisos</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#permisos-globales-settings-py">Permisos Globales (settings.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#permisos-individuales">Permisos individuales</a></li>
<li class="toctree-l3"><a class="reference internal" href="#permisos-personalizados">Permisos personalizados</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#crear-documentacion-automatica">Crear documentación automática</a></li>
<li class="toctree-l2"><a class="reference internal" href="#autenticacion-con-jwt">Autenticación con JWT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#obtener-un-token">Obtener un Token</a></li>
<li class="toctree-l3"><a class="reference internal" href="#haciendo-una-peticion-contra-la-api-con-jwt">Haciendo una petición contra la API con JWT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing en Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="despliegue.html">Gunicorn: Despliegue web</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">JavaScript:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../javascript/sintaxis.html">Sintaxis javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javascript/funciones.html">Funciones</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javascript/entornos.html">NVM: ntornos Virtuales</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javascript/nodejs.html">Entornos: Node.JS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javascript/expressjs.html">Entornos: Node.JS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GO:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../go/sintaxis.html">Sintaxis GO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../go/funciones.html">Funciones predefinidas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../go/librerias.html">Librería Estandar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../go/concurrencia.html">Concurrencia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../go/testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../go/web.html">Desarrollo Web</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">C#:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../csharp/sintaxis.html">Sintaxis C#</a></li>
<li class="toctree-l1"><a class="reference internal" href="../csharp/funciones.html">Funciones predefinidas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../csharp/librerias.html">Namespace System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../csharp/eventos.html">Eventos y Delegados</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Otros Lenguajes:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../otros/basic.html">Basic y Commodore 64</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Fullcoder</a>
        
      </nav>


      <div class="wy-nav-content">

  

  
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
  <li class="breadcrumb"><a href="../index.html">Fullcoder</a> &raquo;</li>
    
  <li class="breadcrumb">Framework: Django Rest Framework</li>

    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/python/drf.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="framework-django-rest-framework">
<h1><a class="toc-backref" href="#id1">Framework: Django Rest Framework</a><a class="headerlink" href="#framework-django-rest-framework" title="Enlazar permanentemente con este título">¶</a></h1>
<a class="reference internal image-reference" href="../_images/logo-django-rest.png"><img alt="Logo HTML5" class="align-center" src="../_images/logo-django-rest.png" style="width: 450.0px; height: 198.75px;" /></a>
<p>Esta es la documentación que he recopilado para trabajar con Django, un framework basado en Python que sirve para desarrollar aplicaciones web.</p>
<div class="contents topic" id="indice">
<p class="topic-title">Índice</p>
<ul class="simple">
<li><p><a class="reference internal" href="#framework-django-rest-framework" id="id1">Framework: Django Rest Framework</a></p>
<ul>
<li><p><a class="reference internal" href="#primeros-pasos" id="id2">Primeros Pasos</a></p>
<ul>
<li><p><a class="reference internal" href="#crear-un-proyecto-django" id="id3">Crear un proyecto Django</a></p></li>
<li><p><a class="reference internal" href="#instalar-y-configurar-django-rest-framework" id="id4">Instalar y configurar Django Rest Framework</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#serializadores" id="id5">Serializadores</a></p></li>
<li><p><a class="reference internal" href="#viewsets" id="id6">ViewSets</a></p>
<ul>
<li><p><a class="reference internal" href="#custom-endpoints" id="id7">Custom Endpoints</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#rutas-de-la-api" id="id8">Rutas de la API</a></p></li>
<li><p><a class="reference internal" href="#modelo-relacional-y-como-mostrarlo" id="id9">Modelo relacional y como mostrarlo</a></p></li>
<li><p><a class="reference internal" href="#permisos" id="id10">Permisos</a></p>
<ul>
<li><p><a class="reference internal" href="#permisos-globales-settings-py" id="id11">Permisos Globales (settings.py)</a></p></li>
<li><p><a class="reference internal" href="#permisos-individuales" id="id12">Permisos individuales</a></p></li>
<li><p><a class="reference internal" href="#permisos-personalizados" id="id13">Permisos personalizados</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#crear-documentacion-automatica" id="id14">Crear documentación automática</a></p></li>
<li><p><a class="reference internal" href="#autenticacion-con-jwt" id="id15">Autenticación con JWT</a></p>
<ul>
<li><p><a class="reference internal" href="#obtener-un-token" id="id16">Obtener un Token</a></p></li>
<li><p><a class="reference internal" href="#haciendo-una-peticion-contra-la-api-con-jwt" id="id17">Haciendo una petición contra la API con JWT</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<section id="primeros-pasos">
<h2><a class="toc-backref" href="#id2">Primeros Pasos</a><a class="headerlink" href="#primeros-pasos" title="Enlazar permanentemente con este título">¶</a></h2>
<section id="crear-un-proyecto-django">
<h3><a class="toc-backref" href="#id3">Crear un proyecto Django</a><a class="headerlink" href="#crear-un-proyecto-django" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Lo primero que vamos a hacer es crear un entorno virtual.</p></li>
<li><p>Luego instalamos Django <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">django</span></code></p></li>
<li><p>Creamos un projecto en Django <code class="docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">startproject</span> <span class="pre">prueba_api</span></code></p></li>
<li><p>Ejecutamos el servidor para ver que se ha creado correctamente <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">runserver</span></code></p></li>
</ul>
</section>
<section id="instalar-y-configurar-django-rest-framework">
<h3><a class="toc-backref" href="#id4">Instalar y configurar Django Rest Framework</a><a class="headerlink" href="#instalar-y-configurar-django-rest-framework" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Empezamos instalando las librerías necesarias:</p>
<ul class="simple">
<li><p>Instalamos Django Rest Framework <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">djangorestframework</span></code></p></li>
<li><p>Instalamos Django-filter <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">django-filter</span></code></p></li>
<li><p>Y por último, instalamos Markdown: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">markdown</span></code></p></li>
</ul>
<p>Pasamos a configurar el proyecto:</p>
<ul class="simple">
<li><p>Lo primero será añadir <strong>rest_framework</strong> a settings.py:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rest_framework&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ahora como mínimo necesitamos tener una app creada, para ello ejecutamos <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">startapp</span> <span class="pre">API</span></code></p></li>
<li><p>Añadimos la app a settings.py:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
    <span class="s1">&#39;API&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Realizamos la migración de la base de datos <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></code></p></li>
<li><p>Y creamos un superusuario <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">createsuperuser</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Una forma cómoda de trabajar con aplicaciones mixtas es crear un directorio API dentro de la app y ahí un nuevo views.py y serializers.py</p>
</div>
</section>
</section>
<section id="serializadores">
<h2><a class="toc-backref" href="#id5">Serializadores</a><a class="headerlink" href="#serializadores" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los serializadores se encargan de trabajar con los modelos de datos para adaptarlos a la API.</p>
<ul class="simple">
<li><p>Para comenzar tenemos que crear un modelo en nuestra API (API/models.py):</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Empleados</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Nombre&quot;</span><span class="p">)</span>
    <span class="n">apellidos</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Apellidos&quot;</span><span class="p">)</span>
    <span class="n">observaciones</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Observaciones&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nombre</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ejecutamos <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">makemigrations</span> <span class="pre">API</span></code> para preparar las migraciones y migramos la tabla <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span> <span class="pre">API</span></code></p></li>
<li><p>Vamos a crear un archivo para los serializadores en la ruta (API/serializers.py):</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importamos la librería de serializers:</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="c1"># Importamos el modelo de datos a usar:</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Empleados</span>

<span class="c1"># Creamos el serializador:</span>
<span class="k">class</span> <span class="nc">EmpleadosSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
<span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
    <span class="c1"># Elegimos el modelo:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Empleados</span>
    <span class="c1"># Podemos elegir los campos a mostrar:</span>
    <span class="c1"># fields = [&#39;nombre&#39;, &#39;apellidos&#39;, &#39;observaciones&#39;]</span>
    <span class="c1"># O mostrar todos los campos:</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s1">&#39;__all__&#39;</span>
</pre></div>
</div>
<p>Con esto ya hemos preparado el primer serializador.</p>
</section>
<section id="viewsets">
<h2><a class="toc-backref" href="#id6">ViewSets</a><a class="headerlink" href="#viewsets" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los viewsets se implementan en las vistas de Django y sirven para mostrar los valores de la API o bien en su frontend o bien como un JSON,
para crear un ViewSet nos vamos a (API/views.py):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="c1"># Importamos la librería de viewsets:</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">viewsets</span>
<span class="c1"># El modelo Empleados:</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Empleados</span>
<span class="c1"># Y el serializador de Empleados:</span>
<span class="kn">from</span> <span class="nn">.serializers</span> <span class="kn">import</span> <span class="n">EmpleadosSerializer</span>

<span class="c1"># Creamos un Viewset para mostrar los datos:</span>
<span class="k">class</span> <span class="nc">EmpleadosViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="c1"># En el lanzamos un QuerySet al modelo Empleados:</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Empleados</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="c1"># y le decimos que lo serialize con EmpleadosSerializer:</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">EmpleadosSerializer</span>
</pre></div>
</div>
<p>Con esto ya tenemos listo el ViewSet.</p>
<section id="custom-endpoints">
<h3><a class="toc-backref" href="#id7">Custom Endpoints</a><a class="headerlink" href="#custom-endpoints" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los Custom endpoints se usan para realizar acciones como filtrado en listas o para actualizar algún tipo de dato específico evítando la creación de nuevos viewsets:</p>
<ul class="simple">
<li><p>Ejemplo de uso añadiendo una opción para puntuar una serie:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span> <span class="nc">SerieViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
<span class="linenos"> 2</span>    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Serie</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="linenos"> 3</span>    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">SerieSerializer</span>
<span class="linenos"> 4</span>    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">SoloMeOrReadOnly</span><span class="p">]</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>    <span class="k">def</span> <span class="nf">get_serializer_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 7</span>        <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serializer_class</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;retrieve&#39;</span><span class="p">:</span>
<span class="linenos">10</span>            <span class="n">serializer</span> <span class="o">=</span> <span class="n">DetailSerieSerializer</span>
<span class="linenos">11</span>        <span class="c1"># se añade la opción del nuevo serializador:</span>
<span class="linenos">12</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;set_score&#39;</span><span class="p">:</span> <span class="c1"># y se utiliza un nuevo serializador específico:</span>
<span class="linenos">13</span>            <span class="n">serializer</span> <span class="o">=</span> <span class="n">ScoreSerializer</span> <span class="c1"># se utiliza el serializador de Score que llama a su modelo</span>
<span class="linenos">14</span>
<span class="linenos">15</span>        <span class="k">return</span> <span class="n">serializer</span>
<span class="linenos">16</span>
<span class="linenos">17</span>        <span class="c1"># Con action vamos a crear un endpoint que establezca otra funcionalidad:</span>
<span class="linenos">18</span>        <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PUT&#39;</span><span class="p">],</span> <span class="n">url_path</span><span class="o">=</span><span class="s1">&#39;set-score&#39;</span><span class="p">,</span> <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span><span class="n">IsAdminUser</span><span class="p">])</span> <span class="c1"># el detail si es True nos hará la acción sobre un elemento en lugar del listado.</span>
<span class="linenos">19</span>        <span class="c1"># bajo este decorador se define la función (get o set) que recibirá además del request un valor entero para realizar la acción:</span>
<span class="linenos">20</span>        <span class="k">def</span> <span class="nf">set_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">serie_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="linenos">21</span>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;serie&#39;</span><span class="p">:</span> <span class="n">serie_id</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">])}</span>
<span class="linenos">22</span>            <span class="c1"># se le pasa la información a la función que controla los serializadores:</span>
<span class="linenos">23</span>            <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_serializer_class</span><span class="p">()(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="linenos">24</span>            <span class="c1"># se valida y si todo va bien se guarda la información:</span>
<span class="linenos">25</span>            <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">26</span>            <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="linenos">27</span>
<span class="linenos">28</span>            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="rutas-de-la-api">
<h2><a class="toc-backref" href="#id8">Rutas de la API</a><a class="headerlink" href="#rutas-de-la-api" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para configurar las rutas de la API utilizamos un archivo adicional de rutas o en nuestro caso vamos a usar el archivo principal (prueba_api/urls.py):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span> <span class="c1"># importamos include</span>
<span class="c1"># Importamos la librería routers de rest_frameworks</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">routers</span>
<span class="c1"># Importamos las vistas de la API</span>
<span class="kn">from</span> <span class="nn">API</span> <span class="kn">import</span> <span class="n">views</span>

<span class="c1"># Creamos un enrutador para la API:</span>
<span class="n">router</span> <span class="o">=</span> <span class="n">routers</span><span class="o">.</span><span class="n">DefaultRouter</span><span class="p">()</span>

<span class="c1"># En el router vamos añadiendo los endpoints a los viewsets:</span>
<span class="n">router</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;empleados&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">EmpleadosViewSet</span><span class="p">)</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/v1/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">router</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span> <span class="c1"># Aquí añadimos la ruta de la api que irá recibiendo los distintos endpoints arriba.</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Ahora podemos ejecutar la API en <code class="docutils literal notranslate"><span class="pre">http://localhost:8080/api/v1/</span></code> y ver como podemos añadir registros.</p>
<div class="admonition attention">
<p class="admonition-title">Atención</p>
<p>Con el nivel actual de permisos cualquiera puede introducir valores en la API. Para cambiar eso tenemos que ir al apartado de <strong>permisos</strong></p>
</div>
</section>
<section id="modelo-relacional-y-como-mostrarlo">
<h2><a class="toc-backref" href="#id9">Modelo relacional y como mostrarlo</a><a class="headerlink" href="#modelo-relacional-y-como-mostrarlo" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En DRF se pueden mostrar las relaciones entre tablas en una vista final entre otras personalizaciones.</p>
<p>Ejemplo de series y episodios:</p>
<ol class="arabic simple">
<li><p>Los serializadores:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Serie</span><span class="p">,</span> <span class="n">Episodio</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">class</span> <span class="nc">SerieSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="linenos"> 8</span>        <span class="n">model</span> <span class="o">=</span> <span class="n">Serie</span>
<span class="linenos"> 9</span>        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">)</span>
<span class="linenos">10</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="k">class</span> <span class="nc">EpisodioSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
<span class="linenos">13</span>
<span class="linenos">14</span>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="linenos">15</span>        <span class="n">model</span> <span class="o">=</span> <span class="n">Episodio</span>
<span class="linenos">16</span>        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="c1"># Para recuperar los episodios de una serie:</span>
<span class="linenos">19</span><span class="k">class</span> <span class="nc">DetailSerieSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
<span class="linenos">20</span>    <span class="c1"># se crea el campo serializado para recuperar los episodios:</span>
<span class="linenos">21</span>    <span class="n">episodes</span> <span class="o">=</span> <span class="n">EpisodioSerializer</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;episodio_set&#39;</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="linenos">24</span>        <span class="c1"># se añade el modelo serie y los campos de esta añadiendo el nuevo campo episodes:</span>
<span class="linenos">25</span>        <span class="n">model</span> <span class="o">=</span> <span class="n">Serie</span>
<span class="linenos">26</span>        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;episodes&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Ahora se modifica el comportamiento del Viewset que queremos:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span> <span class="nc">SerieViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
<span class="linenos"> 2</span>    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Serie</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="linenos"> 3</span>    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">SerieSerializer</span>
<span class="linenos"> 4</span>    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticatedOrReadOnly</span><span class="p">]</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>    <span class="c1"># Ahora hay que relacionar los dos serializadores de Series:</span>
<span class="linenos"> 7</span>    <span class="k">def</span> <span class="nf">get_serializer_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 8</span>        <span class="c1"># Si estamos listando todas las series que devuelva el primer serializador:</span>
<span class="linenos"> 9</span>        <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serializer_class</span>
<span class="linenos">10</span>
<span class="linenos">11</span>        <span class="c1"># Si invocamos la vista detalle o &#39;retrieve&#39; que devuelva la serie con sus episodios:</span>
<span class="linenos">12</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;retrieve&#39;</span><span class="p">:</span>
<span class="linenos">13</span>            <span class="n">serializer</span> <span class="o">=</span> <span class="n">DetailSerieSerializer</span>
<span class="linenos">14</span>
<span class="linenos">15</span>        <span class="k">return</span> <span class="n">serializer</span>
</pre></div>
</div>
<p>De este modo cuando se listan todas las series se muestran tal cual y cuando accedemos a una nos indica los episodios que contiene.</p>
</section>
<section id="permisos">
<h2><a class="toc-backref" href="#id10">Permisos</a><a class="headerlink" href="#permisos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Tenemos varios tipos de permisos para gestionar nusetra API. Para establecer permisos creamos una lista al final de (prueba_api/settings.py):</p>
<ul class="simple">
<li><p>Por defecto nuestra API estará disponible para lectura y escritura ante cualquier extraño.</p></li>
</ul>
<section id="permisos-globales-settings-py">
<h3><a class="toc-backref" href="#id11">Permisos Globales (settings.py)</a><a class="headerlink" href="#permisos-globales-settings-py" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se pueden establecer permisos globales en toda la aplicación editando settings.py:</p>
<ul class="simple">
<li><p>Establecer permisos a solo lectura:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework.permissions.DjangoModelPermissionsOrAnonReadOnly&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Añadir acceso por login para poder editar y ver datos.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework.permissions.IsAuthenticated&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Login requerido para editar y visualización sin login:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;rest_framework.permissions.IsAuthenticatedOrReadOnly&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="permisos-individuales">
<h3><a class="toc-backref" href="#id12">Permisos individuales</a><a class="headerlink" href="#permisos-individuales" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En los ViewSets se pueden definir permisos para cada vista usando la variable <strong>permission_classes</strong>:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">viewsets</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">.serializers</span> <span class="kn">import</span> <span class="n">SerieSerializer</span>
<span class="linenos"> 3</span><span class="c1"># Se importan los permisos que vayamos a establecer como IsAuthenticatedOrReadOnly, IsAuthenticate, o IsAdminUser:</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">rest_framework.permissions</span> <span class="kn">import</span> <span class="n">IsAuthenticatedOrReadOnly</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">series.models</span> <span class="kn">import</span> <span class="n">Consola</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="k">class</span> <span class="nc">ConsolaViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
<span class="linenos"> 8</span>    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Consola</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="linenos"> 9</span>    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ConsolaSerializer</span>
<span class="linenos">10</span>    <span class="c1"># Se establece el permiso para esta vista:</span>
<span class="linenos">11</span>    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticatedOrReadOnly</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="permisos-personalizados">
<h3><a class="toc-backref" href="#id13">Permisos personalizados</a><a class="headerlink" href="#permisos-personalizados" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se puede crear un nuevo permiso y utilizarlo tanto como permiso global como para ViewSets individuales:</p>
<ul class="simple">
<li><p>En la aplicación deseada se crea un archivo <strong>permissions.py</strong>:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># se creará un permiso para que acepte solo un usuario:</span>
<span class="linenos"> 2</span><span class="c1"># se importa el permiso base:</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">rest_framework.permissions</span> <span class="kn">import</span> <span class="n">BasePermission</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1"># se crea la clase del permiso:</span>
<span class="linenos"> 6</span><span class="k">class</span> <span class="nc">SoloMeOrReadOnly</span><span class="p">(</span><span class="n">BasePermission</span><span class="p">):</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>    <span class="c1"># tendrá una función que comprueba si soy yo el que inicia sesión o no:</span>
<span class="linenos"> 9</span>    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
<span class="linenos">10</span>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
<span class="linenos">11</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">12</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">13</span>            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s1">&#39;guillermo&#39;</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span>
<span class="linenos">16</span>    <span class="c1"># Este segundo método se invoca para establecer los permisos en un objeto (un articulo o elemento simple):</span>
<span class="linenos">17</span>    <span class="k">def</span> <span class="nf">has_object_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="linenos">18</span>        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
<span class="linenos">19</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">20</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">21</span>            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s1">&#39;guillermo&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>En el <strong>ViewSet</strong> se invoca y se aplica como un permiso cualquiera:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># se importa el permiso creado:</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">.permissions</span> <span class="kn">import</span> <span class="n">SoloMeOrReadOnly</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">class</span> <span class="nc">ConsolaViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
<span class="linenos"> 5</span>    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Consola</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="linenos"> 6</span>    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ConsolaSerializer</span>
<span class="linenos"> 7</span>    <span class="c1"># ahora se asigna como un permiso cualquiera:</span>
<span class="linenos"> 8</span>    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">SoloMeOrReadOnly</span><span class="p">]</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>    <span class="k">def</span> <span class="nf">get_serializer_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">11</span>        <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serializer_class</span>
<span class="linenos">12</span>
<span class="linenos">13</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;retrieve&#39;</span><span class="p">:</span>
<span class="linenos">14</span>            <span class="n">serializer</span> <span class="o">=</span> <span class="n">DetailConsolaSerializer</span>
<span class="linenos">15</span>
<span class="linenos">16</span>        <span class="k">return</span> <span class="n">serializer</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>El método <strong>has_object_permission</strong> que se ocupa de los permisos de un elemento en la tabla no es obligatorio si vamos a tener los mismos permisos como en el ejemplo anterior.</p>
</div>
</section>
</section>
<section id="crear-documentacion-automatica">
<h2><a class="toc-backref" href="#id14">Crear documentación automática</a><a class="headerlink" href="#crear-documentacion-automatica" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Es muy interesante crear un sistema de documentación automática en nuestra api rest.</p>
<p>Para ello se hace lo siguiente:</p>
<ol class="arabic simple">
<li><p>Instalar coreapi: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">coreapi</span></code></p></li>
<li><p>Crear la ruta de la documentación en urls.py:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># se importa el modulo de documentación:</span>
<span class="linenos">2</span><span class="kn">from</span> <span class="nn">rest_framework.documentation</span> <span class="kn">import</span> <span class="n">include_docs_urls</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos">5</span>    <span class="c1"># se usa el modulo de documentación para cargar las rutas, podemos definir si es pública o privada con el tercer parámetro:</span>
<span class="linenos">6</span>    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;docs/&#39;</span><span class="p">,</span> <span class="n">include_docs_urls</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Nombre API&#39;</span><span class="p">,</span> <span class="n">public</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Se añade a la constante <strong>REST_FRAMEWORK</strong> el siguiente valor en <strong>settings.py</strong>:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;DEFAULT_SCHEMA_CLASS&#39;</span><span class="p">:</span> <span class="s1">&#39;rest_framework.schemas.coreapi.AutoSchema&#39;</span> <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="autenticacion-con-jwt">
<h2><a class="toc-backref" href="#id15">Autenticación con JWT</a><a class="headerlink" href="#autenticacion-con-jwt" title="Enlazar permanentemente con este título">¶</a></h2>
<ol class="arabic simple">
<li><p>Instalar jwt: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">djangorestframework-simplejwt</span></code></p></li>
<li><p>Se añade a <strong>INSTALLED_APPS</strong> la aplicación simplejwt: <code class="docutils literal notranslate"><span class="pre">'rest_framework_simplejwt'</span></code></p></li>
<li><p>Se añaden a la constante <strong>REST_FRAMEWORK</strong> los siguientes valores en <strong>settings.py</strong>:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 2</span>    <span class="s1">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">[</span>
<span class="linenos"> 3</span>        <span class="s1">&#39;rest_framework.permissions.IsAuthenticated&#39;</span><span class="p">,</span>
<span class="linenos"> 4</span>    <span class="p">],</span>
<span class="linenos"> 5</span>    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span> <span class="c1"># Este apartado define los metodos de autenticación</span>
<span class="linenos"> 6</span>        <span class="s1">&#39;rest_framework_simplejwt.authentication.JWTAuthentication&#39;</span><span class="p">,</span> <span class="c1"># este es el método jwt que vamos a usar</span>
<span class="linenos"> 7</span>        <span class="s1">&#39;rest_framework.authentication.SessionAuthentication&#39;</span><span class="p">,</span> <span class="c1"># este es el método por sesión</span>
<span class="linenos"> 8</span>        <span class="s1">&#39;rest_framework.authentication.BasicAuthentication&#39;</span><span class="p">,</span> <span class="c1"># y este es el método básico de usuario y contraseña</span>
<span class="linenos"> 9</span>    <span class="p">),</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Toca añadir las rutas para obtener el token de autenticación en urls.py:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Se importan los metodos para obtener y refrescar el token:</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">rest_framework_simplejwt.views</span> <span class="kn">import</span> <span class="n">TokenObtainPairView</span><span class="p">,</span> <span class="n">TokenRefreshView</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 6</span>    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">router</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
<span class="linenos"> 7</span>    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<span class="linenos"> 8</span>    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;docs/&#39;</span><span class="p">,</span> <span class="n">include_docs_urls</span><span class="p">(</span><span class="s1">&#39;API Fetlix&#39;</span><span class="p">,</span> <span class="n">public</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
<span class="linenos"> 9</span>    <span class="c1"># Añadimos la ruta para obtener el token y para refrescarlo:</span>
<span class="linenos">10</span>    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/token&#39;</span><span class="p">,</span> <span class="n">TokenObtainPairView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;token_obtain_pair&#39;</span><span class="p">),</span>
<span class="linenos">11</span>    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/token/refresh/&#39;</span><span class="p">,</span> <span class="n">TokenRefreshView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;token_refresh&#39;</span><span class="p">)</span>
<span class="linenos">12</span><span class="p">]</span>
</pre></div>
</div>
<section id="obtener-un-token">
<h3><a class="toc-backref" href="#id16">Obtener un Token</a><a class="headerlink" href="#obtener-un-token" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para obtener un Token se hace lo siguiente:
1. Abrir Postman o Insomnia (u otro cliente API).
2. Ejecutar una petición <strong>POST</strong> a la ruta <strong>http://127.0.0.1:8000/api/token</strong> con usuario y contraseña:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos">2</span><span class="w">        </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;misterg@gmail.com&quot;</span><span class="p">,</span><span class="w"></span>
<span class="linenos">3</span><span class="w">        </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="s2">&quot;maizfrito&quot;</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Esto nos devolverá un token por ejemplo:</p></li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">{</span><span class="w"></span>
<span class="linenos">2</span><span class="w">    </span><span class="nt">&quot;refresh&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTY0NjA1MzkxNCwiaWF0IjoxNjQ1OTY3NTE0LCJqdGkiOiJmOGVhOWUzNTdhMGU0ZWU4ODU0Y2NiNWE2NTdjOGY1ZiIsInVzZXJfaWQiOjN9.9DvZVyzfZcmB-v9P_mgETFighXz2KjChPc_EslH5X3M&quot;</span><span class="p">,</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="nt">&quot;access&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjQ1OTY3ODE0LCJpYXQiOjE2NDU5Njc1MTQsImp0aSI6IjBhNmEyNWM2YjVlMDQ4ZjQ5MzQxYzM2MGNlODM2OTdiIiwidXNlcl9pZCI6M30.He7w5XxjCrgeWupFOnGdVH4EusJ5fRZMbY3zkyZetCI&quot;</span><span class="w"></span>
<span class="linenos">4</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Ahora este token «access» se utilizará para todas las operaciones contra la API que requieran autenticación.</p></li>
</ol>
</section>
<section id="haciendo-una-peticion-contra-la-api-con-jwt">
<h3><a class="toc-backref" href="#id17">Haciendo una petición contra la API con JWT</a><a class="headerlink" href="#haciendo-una-peticion-contra-la-api-con-jwt" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Ejemplo de uso con Python.</p>
<p>La petición se podría dividir en dos partes:</p>
<ol class="arabic simple">
<li><p>Solicitud de token:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 4</span>    <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<span class="linenos"> 5</span>    <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;*/*&#39;</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="p">}</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;username&quot;:&quot;misterg@gmail.com&quot;, &quot;password&quot;:&quot;sabotaje&quot;}&#39;</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:8000/api/token&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="linenos">11</span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
<span class="linenos">12</span><span class="n">token</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Petición de datos (listado de series):</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bearer &#39;</span> <span class="o">+</span> <span class="n">token</span><span class="p">[</span><span class="s1">&#39;access&#39;</span><span class="p">]</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:8000/api/series/&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="linenos">4</span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
<span class="linenos">5</span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="testing.html" class="btn btn-neutral float-right" title="Testing en Python" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="flask.html" class="btn btn-neutral float-left" title="Microframework: Flask" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Creado por Guillermo Granados Gomez bajo Licencia MIT

    </p>
  </div> 

</footer>

        </div>


      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>